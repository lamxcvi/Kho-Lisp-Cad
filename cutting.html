<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>T·ªëi ∆Øu C·∫Øt V·∫≠t Li·ªáu</title>
    <style>
        body { font-family: 'Segoe UI', sans-serif; background-color: #1e1e1e; color: #d4d4d4; padding: 20px; text-align: center; }
        .container { max-width: 900px; margin: 0 auto; background: #252526; padding: 30px; border-radius: 10px; border: 1px solid #3e3e42; box-shadow: 0 4px 15px rgba(0,0,0,0.5); }
        h1 { color: #4ec9b0; margin-top: 0; }
        
        .control-group { margin-bottom: 20px; text-align: left; background: #333; padding: 15px; border-radius: 8px;}
        label { display: block; margin-bottom: 5px; color: #ce9178; font-weight: bold; }
        input { padding: 8px; border-radius: 4px; border: 1px solid #555; background: #222; color: white; width: 100px; text-align: center; font-weight: bold;}
        
        /* B·∫£ng nh·∫≠p li·ªáu */
        table { width: 100%; border-collapse: collapse; margin-top: 10px; }
        th { text-align: left; color: #aaa; padding: 5px; border-bottom: 1px solid #555; }
        td { padding: 5px; }
        .input-len { width: 100%; box-sizing: border-box; }
        .input-qty { width: 100%; box-sizing: border-box; }
        
        .btn { border: none; padding: 10px 20px; border-radius: 5px; font-weight: bold; cursor: pointer; color: white; margin-top: 10px; transition: 0.3s;}
        .btn-add { background: #569cd6; font-size: 14px;}
        .btn-calc { background: #d16d00; width: 100%; font-size: 18px; margin-top: 20px;}
        .btn-calc:hover { background: #e67e00; }
        .btn-del { background: #ff5555; padding: 5px 10px; }
        .btn-back { background-color: #444; margin-bottom: 20px; padding: 8px 15px; text-decoration: none; display: inline-block; color: white; border-radius: 4px;}

        /* K·∫øt qu·∫£ */
        #result-area { margin-top: 30px; text-align: left; display: none; }
        .bar-container { margin-bottom: 20px; background: #1e1e1e; border: 1px solid #444; padding: 10px; border-radius: 5px; }
        .bar-title { font-weight: bold; color: #4ec9b0; margin-bottom: 5px; display: flex; justify-content: space-between; }
        
        .visual-bar { height: 30px; background: #333; display: flex; border-radius: 4px; overflow: hidden; margin-top: 5px;}
        .segment { height: 100%; display: flex; align-items: center; justify-content: center; font-size: 12px; color: #000; font-weight: bold; border-right: 1px solid rgba(0,0,0,0.2); transition: width 0.5s;}
        .seg-part { background: #4caf50; color: white;} /* Ph·∫ßn l·∫•y */
        .seg-waste { background: #ff5555; color: white;} /* Ph·∫ßn th·ª´a */

        .summary-box { background: #0e639c; padding: 15px; border-radius: 8px; margin-bottom: 20px; color: white; }
    </style>
</head>
<body>

    <a href="index.html" class="btn-back">‚¨Ö Quay l·∫°i Trang ch·ªß</a>

    <div class="container">
        <h1>‚úÇÔ∏è T·ªêI ∆ØU C·∫ÆT V·∫¨T LI·ªÜU</h1>
        
        <div class="control-group">
            <div style="display: flex; gap: 20px; align-items: flex-end;">
                <div>
                    <label>Chi·ªÅu d√†i c√¢y nguy√™n (mm):</label>
                    <input type="number" id="stockLength" value="6000">
                </div>
                <div>
                    <label>ƒê·ªô d√†y l∆∞·ª°i c·∫Øt (mm):</label>
                    <input type="number" id="bladeWidth" value="5">
                </div>
            </div>
        </div>

        <div class="control-group">
            <label>Danh s√°ch c·∫ßn c·∫Øt:</label>
            <table id="inputTable">
                <thead>
                    <tr>
                        <th>STT</th>
                        <th>Chi·ªÅu d√†i (mm)</th>
                        <th>S·ªë l∆∞·ª£ng</th>
                        <th>X√≥a</th>
                    </tr>
                </thead>
                <tbody id="tableBody">
                    <tr>
                        <td>1</td>
                        <td><input type="number" class="input-len" value="1500"></td>
                        <td><input type="number" class="input-qty" value="2"></td>
                        <td><button class="btn btn-del" onclick="deleteRow(this)">X</button></td>
                    </tr>
                    <tr>
                        <td>2</td>
                        <td><input type="number" class="input-len" value="2000"></td>
                        <td><input type="number" class="input-qty" value="3"></td>
                        <td><button class="btn btn-del" onclick="deleteRow(this)">X</button></td>
                    </tr>
                </tbody>
            </table>
            <button class="btn btn-add" onclick="addRow()">+ Th√™m d√≤ng</button>
        </div>

        <button class="btn btn-calc" onclick="calculateCut()">üöÄ T√çNH TO√ÅN PH∆Ø∆†NG √ÅN C·∫ÆT</button>

        <div id="result-area">
            <div class="summary-box" id="summary"></div>
            <div id="bars-list"></div>
        </div>
    </div>

    <script>
        function addRow() {
            const tbody = document.getElementById('tableBody');
            const rowCount = tbody.rows.length + 1;
            const row = `
                <tr>
                    <td>${rowCount}</td>
                    <td><input type="number" class="input-len" placeholder="Nh·∫≠p d√†i"></td>
                    <td><input type="number" class="input-qty" value="1"></td>
                    <td><button class="btn btn-del" onclick="deleteRow(this)">X</button></td>
                </tr>
            `;
            tbody.insertAdjacentHTML('beforeend', row);
            updateIndex();
        }

        function deleteRow(btn) {
            btn.closest('tr').remove();
            updateIndex();
        }

        function updateIndex() {
            const rows = document.querySelectorAll('#tableBody tr');
            rows.forEach((row, index) => {
                row.cells[0].innerText = index + 1;
            });
        }

        function calculateCut() {
            const stockLen = parseInt(document.getElementById('stockLength').value);
            const blade = parseInt(document.getElementById('bladeWidth').value);
            
            // 1. L·∫•y d·ªØ li·ªáu input
            let parts = [];
            document.querySelectorAll('#tableBody tr').forEach(row => {
                const len = parseInt(row.querySelector('.input-len').value);
                const qty = parseInt(row.querySelector('.input-qty').value);
                if (len && qty && len > 0 && qty > 0) {
                    if (len > stockLen) {
                        alert(`L·ªói: ƒêo·∫°n ${len}mm d√†i h∆°n c√¢y nguy√™n (${stockLen}mm)!`);
                        return;
                    }
                    for(let i=0; i<qty; i++) parts.push(len);
                }
            });

            if(parts.length === 0) { alert("Vui l√≤ng nh·∫≠p k√≠ch th∆∞·ªõc c·∫ßn c·∫Øt!"); return; }

            // 2. Thu·∫≠t to√°n Greedy (S·∫Øp x·∫øp gi·∫£m d·∫ßn -> Nh√©t v√†o ch·ªó tr·ªëng ƒë·∫ßu ti√™n)
            parts.sort((a, b) => b - a); // D√†i nh·∫•t x·∫øp tr∆∞·ªõc

            let bars = []; // Danh s√°ch c√°c c√¢y nguy√™n li·ªáu ƒë√£ d√πng

            parts.forEach(part => {
                let placed = false;
                
                // Duy·ªát qua c√°c c√¢y ƒë√£ c√≥ xem c√¢y n√†o c√≤n nh√©t v·ª´a kh√¥ng
                for (let bar of bars) {
                    // C·∫ßn kh√¥ng gian = D√†i ƒëo·∫°n + L∆∞·ª°i c·∫Øt
                    // Tuy nhi√™n ƒëo·∫°n cu·ªëi c√πng c·ªßa c√¢y kh√¥ng t·ªën l∆∞·ª°i c·∫Øt sau n√≥, 
                    // nh∆∞ng ƒë·ªÉ an to√†n v√† ƒë∆°n gi·∫£n, ta c·ª© t√≠nh tr·ª´ lu√¥n m·∫°ch c·∫Øt cho m·ªói ƒëo·∫°n.
                    if (bar.remaining >= part) {
                        bar.cuts.push(part);
                        bar.remaining -= (part + blade); // Tr·ª´ ƒëi ƒëo·∫°n c·∫Øt v√† m·∫°ch c∆∞a
                        placed = true;
                        break;
                    }
                }

                // N·∫øu kh√¥ng c√¢y n√†o v·ª´a, l·∫•y c√¢y m·ªõi
                if (!placed) {
                    let newBar = {
                        id: bars.length + 1,
                        cuts: [part],
                        remaining: stockLen - part - blade
                    };
                    bars.push(newBar);
                }
            });

            // 3. Hi·ªÉn th·ªã k·∫øt qu·∫£
            renderResult(bars, stockLen, blade);
        }

        function renderResult(bars, stockLen, blade) {
            const resArea = document.getElementById('result-area');
            const summary = document.getElementById('summary');
            const list = document.getElementById('bars-list');
            
            // T·ªïng k·∫øt
            let totalWasteLen = 0;
            bars.forEach(b => {
                // T√≠nh l·∫°i ph·∫ßn th·ª´a th·ª±c t·∫ø (b·ªè qua m·∫°ch c·∫Øt cu·ªëi c√πng n·∫øu c√≥)
                // Nh∆∞ng logic hi·ªÉn th·ªã n√™n gi·ªØ nguy√™n theo thu·∫≠t to√°n
                if(b.remaining < 0) b.remaining = 0;
                totalWasteLen += b.remaining;
            });
            
            // T√≠nh % hao h·ª•t (Kh√¥ng t√≠nh m·∫°ch c·∫Øt l√† hao h·ª•t m√† l√† chi ph√≠ k·ªπ thu·∫≠t, ch·ªâ t√≠nh ƒë·∫ßu th·ª´a)
            let totalUsed = bars.length * stockLen;
            let wastePercent = (totalWasteLen / totalUsed * 100).toFixed(2);

            summary.innerHTML = `
                <h3>K·∫æT QU·∫¢ T√çNH TO√ÅN</h3>
                <div>T·ªïng s·ªë c√¢y c·∫ßn d√πng: <b>${bars.length} c√¢y</b> (L= ${stockLen}mm)</div>
                <div>T·ªïng ƒëo·∫°n th·ª´a (Decal): <b>${totalWasteLen} mm</b> (${wastePercent}%)</div>
            `;

            list.innerHTML = "";

            bars.forEach(bar => {
                let cutsHtml = "";
                let currentPos = 0;
                
                bar.cuts.forEach(c => {
                    let widthPercent = (c / stockLen) * 100;
                    cutsHtml += `<div class="segment seg-part" style="width: ${widthPercent}%" title="C·∫Øt: ${c}mm">${c}</div>`;
                    
                    // V·∫Ω m·∫°ch c·∫Øt (n·∫øu nh·ªè qu√° th√¨ kh√¥ng hi·ªán text)
                    let bladePercent = (blade / stockLen) * 100;
                    if(blade > 0) cutsHtml += `<div class="segment" style="width: ${bladePercent}%; background: #000;"></div>`;
                });

                // V·∫Ω ph·∫ßn th·ª´a
                let wasteLen = bar.remaining;
                if (wasteLen > 0) {
                     let wastePercent = (wasteLen / stockLen) * 100;
                     cutsHtml += `<div class="segment seg-waste" style="width: ${wastePercent}%" title="Th·ª´a: ${wasteLen}mm">${wasteLen}</div>`;
                }

                let textDetail = bar.cuts.join(" + ");

                list.innerHTML += `
                    <div class="bar-container">
                        <div class="bar-title">
                            <span>C√¢y s·ªë ${bar.id}</span>
                            <span style="color: #ff5555">D∆∞: ${wasteLen}mm</span>
                        </div>
                        <div style="font-size: 0.9em; color: #888;">C·∫Øt: ${textDetail}</div>
                        <div class="visual-bar">
                            ${cutsHtml}
                        </div>
                    </div>
                `;
            });

            resArea.style.display = "block";
        }
    </script>
</body>
</html>
