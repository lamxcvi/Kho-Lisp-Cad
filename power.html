<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>T√≠nh P-S-Q & Ch·ªçn D√¢y (Kinden Std)</title>
    <style>
        body { font-family: 'Segoe UI', Tahoma, sans-serif; background-color: #1e1e1e; color: #d4d4d4; padding: 20px; text-align: center; }
        .container { max-width: 700px; margin: 0 auto; background: #252526; padding: 30px; border-radius: 8px; border: 1px solid #3e3e42; box-shadow: 0 4px 15px rgba(0,0,0,0.5); }
        h1 { color: #4ec9b0; margin-top: 0; text-transform: uppercase; font-size: 1.8em; }
        .subtitle { color: #888; font-style: italic; font-size: 0.9em; margin-bottom: 25px; }
        
        /* Grid Layout */
        .input-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; text-align: left; margin-bottom: 20px; }
        .full-width { grid-column: span 2; }
        
        label { display: block; margin-bottom: 5px; color: #ce9178; font-weight: bold; font-size: 0.95em; }
        select, input { width: 100%; padding: 10px; border-radius: 4px; border: 1px solid #555; background: #333; color: white; box-sizing: border-box; font-size: 15px; outline: none; }
        input:focus, select:focus { border-color: #4ec9b0; background: #3c3c3c; }

        .btn-calc { background-color: #007acc; width: 100%; margin-top: 10px; font-weight: bold; border: none; padding: 12px; border-radius: 4px; color: white; cursor: pointer; transition: 0.3s; font-size: 16px; text-transform: uppercase; }
        .btn-calc:hover { background-color: #0062a3; }
        
        .btn-back { background-color: #444; margin-bottom: 20px; padding: 8px 15px; font-size: 14px; display: inline-block; text-decoration: none; border-radius: 4px; color: white;}

        /* K·∫æT QU·∫¢ */
        .result-panel { margin-top: 25px; text-align: left; background: #2d2d30; border: 1px solid #444; border-radius: 8px; overflow: hidden; display: none; }
        .res-header { background: #3e3e42; padding: 10px 20px; font-weight: bold; color: #fff; border-bottom: 1px solid #555; }
        .res-body { padding: 20px; }
        
        /* B·∫£ng c√¥ng su·∫•t P-S-Q */
        .power-grid { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 10px; margin-bottom: 20px; text-align: center; background: #252526; padding: 10px; border-radius: 5px; border: 1px dashed #555;}
        .p-box { border-right: 1px solid #444; }
        .p-box:last-child { border-right: none; }
        .p-label { display: block; font-size: 0.8em; color: #aaa; margin-bottom: 5px; }
        .p-val { font-size: 1.1em; font-weight: bold; color: #fff; }
        .p-unit { font-size: 0.8em; color: #4ec9b0; }

        .res-item { margin-bottom: 15px; border-bottom: 1px dashed #444; padding-bottom: 10px; }
        .res-label { display: block; color: #888; font-size: 0.9em; margin-bottom: 3px; }
        .res-value { font-size: 1.3em; font-weight: bold; color: #4ec9b0; }
        .res-spec { font-family: monospace; color: #dcdcaa; font-size: 1.1em; }
        
        .highlight { color: #ce9178; } 
    </style>
</head>
<body>

    <a href="index.html" class="btn-back">‚¨Ö Quay l·∫°i Trang ch·ªß</a>

    <div class="container">
        <h1>‚ö° T√çNH P-S-Q & CH·ªåN D√ÇY</h1>
        <div class="subtitle">Ti√™u chu·∫©n Kinden Vi·ªát Nam (Safety First)</div>
        
        <div class="input-grid">
            <div>
                <label>Ngu·ªìn ƒëi·ªán (Voltage):</label>
                <select id="voltage">
                    <option value="1">1 Pha (220V)</option>
                    <option value="3">3 Pha (380V)</option>
                </select>
            </div>

            <div>
                <label>Lo·∫°i t·∫£i (H·ªá s·ªë K):</label>
                <select id="loadType">
                    <option value="1.0">Tƒ©nh (ƒê√®n, Heater)</option>
                    <option value="1.25">ƒê·ªông l·ª±c (Motor)</option>
                    <option value="1.5">Thang m√°y / C·∫©u</option>
                </select>
            </div>

            <div class="full-width">
                <label>Nh·∫≠p gi√° tr·ªã ƒë·∫ßu v√†o:</label>
                <div style="display: flex; gap: 10px;">
                    <input type="number" id="inputVal" placeholder="Nh·∫≠p s·ªë..." style="flex: 2;">
                    <select id="inputUnit" style="flex: 1;">
                        <option value="kw">kW (P)</option>
                        <option value="hp">HP (M√£ l·ª±c)</option>
                        <option value="kva">kVA (S)</option>
                        <option value="a">Ampe (I)</option>
                    </select>
                </div>
            </div>

            <div>
                <label>H·ªá s·ªë c√¥ng su·∫•t (cosœÜ):</label>
                <input type="number" id="cosphi" value="0.85" step="0.05">
            </div>

             <div>
                <label>Chi·ªÅu d√†i d√¢y (m):</label>
                <input type="number" id="distance" value="20">
            </div>
        </div>

        <button class="btn-calc" onclick="calculate()">üöÄ T√çNH TO√ÅN CHI TI·∫æT</button>

        <div class="result-panel" id="resultPanel">
            <div class="res-header">PH√ÇN T√çCH C√îNG SU·∫§T</div>
            <div class="res-body">
                
                <div class="power-grid">
                    <div class="p-box">
                        <span class="p-label">T√°c d·ª•ng (P)</span>
                        <div class="p-val" id="outP">0</div>
                        <span class="p-unit">kW</span>
                    </div>
                    <div class="p-box">
                        <span class="p-label">Bi·ªÉu ki·∫øn (S)</span>
                        <div class="p-val" id="outS">0</div>
                        <span class="p-unit">kVA</span>
                    </div>
                    <div class="p-box">
                        <span class="p-label">Ph·∫£n kh√°ng (Q)</span>
                        <div class="p-val" id="outQ">0</div>
                        <span class="p-unit">kVAr</span>
                    </div>
                </div>

                <div class="res-item">
                    <span class="res-label">D√≤ng ƒëi·ªán t√≠nh to√°n (I design):</span>
                    <span class="res-value highlight" id="resI">0 A</span>
                    <div style="font-size: 0.8em; color: #666;">(ƒê√£ nh√¢n h·ªá s·ªë an to√†n K)</div>
                </div>

                <div class="res-item">
                    <span class="res-label">Thi·∫øt b·ªã ƒë√≥ng c·∫Øt (Breaker):</span>
                    <span class="res-value" id="resBreaker">...</span>
                </div>

                <div class="res-item">
                    <span class="res-label">C√°p ngu·ªìn (Feeder Cable - XLPE):</span>
                    <div class="res-spec" id="resCable">...</div>
                    <div class="res-spec" id="resEarth" style="font-size: 0.9em; color: #888;">...</div>
                </div>
                
            </div>
        </div>
    </div>

    <script>
        const cableTable = [
            { s: 1.5, iz: 24 }, { s: 2.5, iz: 33 }, { s: 4.0, iz: 45 }, { s: 6.0, iz: 57 },
            { s: 10, iz: 76 }, { s: 16, iz: 101 }, { s: 25, iz: 135 }, { s: 35, iz: 169 },
            { s: 50, iz: 207 }, { s: 70, iz: 268 }, { s: 95, iz: 328 }, { s: 120, iz: 383 },
            { s: 150, iz: 444 }, { s: 185, iz: 510 }, { s: 240, iz: 607 }, { s: 300, iz: 703 }
        ];
        const breakerStd = [6, 10, 16, 20, 25, 32, 40, 50, 63, 75, 80, 100, 125, 150, 160, 200, 225, 250, 300, 400, 500, 630];

        function calculate() {
            const phase = parseInt(document.getElementById('voltage').value);
            const k_factor = parseFloat(document.getElementById('loadType').value);
            const val = parseFloat(document.getElementById('inputVal').value);
            const unit = document.getElementById('inputUnit').value;
            const cos = parseFloat(document.getElementById('cosphi').value) || 0.85;

            if (!val) { alert("Vui l√≤ng nh·∫≠p gi√° tr·ªã!"); return; }

            // 1. T√çNH TO√ÅN P, S, Q, I
            let P_kw = 0, S_kva = 0, Q_kvar = 0, I_ampe = 0;

            // Quy ƒë·ªïi m·ªçi th·ª© v·ªÅ S (kVA) tr∆∞·ªõc ƒë·ªÉ d·ªÖ t√≠nh
            if (unit === 'kw') {
                P_kw = val;
                S_kva = P_kw / cos;
            } else if (unit === 'hp') {
                P_kw = val * 0.746;
                S_kva = P_kw / cos;
            } else if (unit === 'kva') {
                S_kva = val;
                P_kw = S_kva * cos;
            } else if (unit === 'a') {
                I_ampe = val;
                // S = U * I * sqrt(3) / 1000
                if (phase === 1) S_kva = (220 * I_ampe) / 1000;
                else S_kva = (380 * 1.732 * I_ampe) / 1000;
                
                P_kw = S_kva * cos;
            }

            // T√≠nh Q = cƒÉn(S^2 - P^2)
            Q_kvar = Math.sqrt(Math.pow(S_kva, 2) - Math.pow(P_kw, 2));

            // T√≠nh l·∫°i d√≤ng ƒëi·ªán I (n·∫øu ch∆∞a c√≥)
            if (unit !== 'a') {
                if (phase === 1) I_ampe = (S_kva * 1000) / 220;
                else I_ampe = (S_kva * 1000) / (380 * 1.732);
            }

            // D√≤ng t√≠nh to√°n (ƒë√£ nh√¢n h·ªá s·ªë an to√†n/kh·ªüi ƒë·ªông)
            let I_design = I_ampe * k_factor;

            // 2. CH·ªåN BREAKER
            let In = breakerStd.find(at => at >= I_design);
            if (!In) In = "MAX";
            
            let breakerType = (In <= 63) ? "MCB" : "MCCB";
            let pole = (phase === 1) ? "2P" : "3P";

            // 3. CH·ªåN C√ÅP (Iz >= In)
            let selectedCable = cableTable.find(c => c.iz >= In);
            if (!selectedCable) selectedCable = { s: "Busbar/Multiple", iz: 0 };
            
            // T√≠nh d√¢y Earth
            let S_phase = selectedCable.s;
            let Spe = "System";
            if (typeof S_phase === 'number') {
                if (S_phase <= 16) Spe = S_phase;
                else if (S_phase <= 35) Spe = 16;
                else Spe = S_phase / 2;
                
                // Chu·∫©n h√≥a Spe v·ªÅ size c√≥ th·ª±c
                let realSpe = cableTable.find(c => c.s >= Spe);
                if(realSpe) Spe = realSpe.s;
            }

            // 4. HI·ªÇN TH·ªä
            document.getElementById('outP').innerText = P_kw.toFixed(2);
            document.getElementById('outS').innerText = S_kva.toFixed(2);
            document.getElementById('outQ').innerText = Q_kvar.toFixed(2);
            document.getElementById('resI').innerText = I_design.toFixed(1) + " A";

            document.getElementById('resBreaker').innerText = `${breakerType} ${pole} ${In}A`;
            
            let cableName = "";
            if (phase === 1) cableName = `Cu/XLPE/PVC 2C x ${S_phase} mm¬≤`;
            else {
                if(typeof S_phase === 'number' && S_phase > 16)
                    cableName = `Cu/XLPE/PVC 3C x ${S_phase} mm¬≤ + 1C x ${Math.max(S_phase/2, 16)} mm¬≤ N`;
                else 
                    cableName = `Cu/XLPE/PVC 4C x ${S_phase} mm¬≤`;
            }
            
            document.getElementById('resCable').innerText = cableName;
            document.getElementById('resEarth').innerText = `+ 1C x ${Spe} mm¬≤ E (Ti·∫øp ƒë·ªãa)`;

            document.getElementById('resultPanel').style.display = 'block';
        }
    </script>
</body>
</html>
